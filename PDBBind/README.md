# SPECTRA on PDBBind dataset

This directory contains the scripts to run SPECTRA on the PDBBind dataset. The PDBBind dataset was gathered
from [Equibind](https://zenodo.org/records/6408497). The different scripts run different steps of SPECTRA.

## Step 1: Defining molecular sequence properties

`equibind_similarity_util.py`: This script provides the utilities to calculate whether two protein-ligand pairs are similar. Two pairs are similar 
if their sequences are more than 30% similar or ligands more than 99% similar. 

## Step 2: Calculating the molecular sequence property graph

`calculate_similarity_equibind.py`: This script creates the edge list for the molecular sequence property graph, doing a pairwise calculation of similarity for all
protein-ligand pairs in equibind_dataset.csv and adding pairs to the edge list if they are similar.

`create_graph_equibind.py`: This script creates the molecular sequence property graph from the equibind dataset where nodes are protein-ligand pairs and edges
are between similar pairs. It takes in the edge list generated by the calculate_similarity_equibind.py script.

## Step 3: Generating spectral splits from molecular sequence property graph

`create_splits_equibind.py`: This scrips takes in the generated molecular sequence property graph and generate splits for the input spectral parameter.
For the paper, we generated splits with spectral parameter ranging from 0 to 1 in 0.025 increments. Results are stored in the 
`equibind splits directory`: `equibind splits directory/lambda_0.05.txt` is the split generated at a spectral parameter of 0.05, each file contains in the first line
the spectral parameter followed by the calculated cross-split overlap and the number of samples in the split. After that is the ids of the 
protein-ligand pairs in the train versus the test as indexed in the equibind dataset stored in `equibind_dataset.csv`.

## Step 4: Calculating cross-split overlap of existing protein-ligand datasets to the equibind training set

The datasets we considered was the [Astex diverse set](https://www.ccdc.cam.ac.uk/support-and-resources/downloads/), 
[Posebusters](https://zenodo.org/records/8278563), and [LPPBDBind](https://github.com/THGLab/LP-PDBBind/tree/master/dataset). 

`calculate_similarity.py`: This script calculates cross-split overlap of these datasets to the equibind training set. Results are stored in the `equibind_similarity_calculations`
directory: `equibind_similarity_calculations/astex_results.txt` contains contains the number of samples in the astex diverse set that overlaps with the equibind training set, 
`equibind_similarity_calculations/similarity_results_astex_equibind` is a pickled dictionary that maps every sample in the astex diverse ssest to its similar sample in the equibind
training or None if there is no similar sample in the equibind training set.

## Step 5: Constructing partial spectral performance curves

`Spectral performance curve.ipynb` takes the results from `create_splits_equibind.py` and `calculate_similarity.py` to find spectral parameters that 
generate splits with similar levels of cross-split overlap to those generated by SPECTRA. It constructs partial spectral performance curves for 
Diffdock, Equibind, and Tankbind based on reported results from Posebusters and [Diffdock](https://arxiv.org/pdf/2210.01776.pdf).


